<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0b0f17">
  <meta name="description" content="Tracciatore di distanza in tempo reale per relazioni a distanza">
  <title>La Distanza Non Conta ğŸ«¶</title>
  
  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icons/icon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="icons/icon.svg">
  
  <!-- Styles -->
  <link rel="stylesheet" href="style.css">
  
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>
</head>
<body>
  
  <!-- ============================================
       TULIP FIELD ANIMATION (DISABLED)
       To enable: Remove the comments around this section
       and uncomment the CSS/JS code below
       ============================================ -->
  <!-- 
  <div id="tulip-field" class="field" aria-hidden="true"></div>
  -->

  <!-- Decorative Tulips -->
  <img src="icons/tulip-flower-tulip-e86aa6cc84acd5541c7c39395ff77aa9.png" 
       class="tulip-decoration tulip-left" 
       alt="Tulip decoration">
  
  <img src="icons/tulip-flower-tulip-e86aa6cc84acd5541c7c39395ff77aa9.png" 
       class="tulip-decoration tulip-right" 
       alt="Tulip decoration">

  <!-- Auth Screen -->
  <div id="auth-screen" class="auth-screen hidden">
    <div class="auth-container">
      <div class="auth-icon">ğŸ«¶</div>
      <h1 class="auth-title">La Distanza Non Conta</h1>
      <p class="auth-subtitle">Accedi per usare il tuo tracker</p>
      
      <div id="auth-form" class="auth-form">
        <div class="form-group">
          <label for="auth-email">Email</label>
          <input type="email" id="auth-email" placeholder="tua@email.com" autocomplete="email">
        </div>
        <div class="form-group">
          <label for="auth-password">Password</label>
          <input type="password" id="auth-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password">
        </div>
        <div id="auth-error" class="auth-error hidden"></div>
        <button id="auth-signin-btn" class="btn btn-primary btn-full">Accedi</button>
        <button id="auth-signup-btn" class="btn btn-secondary btn-full">Crea Account</button>
      </div>
      
      <p class="auth-footer">I tuoi dati sono protetti con crittografia end-to-end ğŸ”’</p>
    </div>
  </div>

  <!-- PIN Lock Screen -->
  <div id="pin-lock-screen" class="pin-lock-screen hidden">
    <div class="pin-container">
      <div class="pin-icon">ğŸ”’</div>
      <h2 id="pin-title">Inserisci PIN</h2>
      <p id="pin-subtitle" class="pin-subtitle">Inserisci il tuo PIN a 4 cifre per sbloccare</p>
      <div class="pin-dots" id="pin-dots">
        <span class="pin-dot"></span>
        <span class="pin-dot"></span>
        <span class="pin-dot"></span>
        <span class="pin-dot"></span>
      </div>
      <div id="pin-error" class="pin-error hidden">PIN errato. Riprova.</div>
      <div class="pin-keypad">
        <button class="pin-key" data-key="1">1</button>
        <button class="pin-key" data-key="2">2</button>
        <button class="pin-key" data-key="3">3</button>
        <button class="pin-key" data-key="4">4</button>
        <button class="pin-key" data-key="5">5</button>
        <button class="pin-key" data-key="6">6</button>
        <button class="pin-key" data-key="7">7</button>
        <button class="pin-key" data-key="8">8</button>
        <button class="pin-key" data-key="9">9</button>
        <button class="pin-key pin-key-empty"></button>
        <button class="pin-key" data-key="0">0</button>
        <button class="pin-key pin-key-delete" data-key="delete">âŒ«</button>
      </div>
    </div>
  </div>

  <div class="container hidden" id="main-app">
    <!-- Header -->
    <header class="header">
      <h1 class="title">La Distanza Non Conta <span class="heart">ğŸ«¶</span></h1>
      <p class="subtitle">Tracker in tempo reale per <span id="person1-name">Jakob</span> & <span id="person2-name">Desy</span></p>
    </header>

    <!-- Setup Panel (shown first time) -->
    <div id="setup-panel" class="card setup-panel hidden">
      <h2>ğŸ”§ Configurazione Iniziale</h2>
      <p>Inserisci i tuoi dati per iniziare:</p>
      
      <div class="form-row">
        <div class="form-group">
          <label for="setup-person1">Il Tuo Nome:</label>
          <input type="text" id="setup-person1" placeholder="Jakob">
        </div>
        <div class="form-group">
          <label for="setup-person2">Nome del Partner:</label>
          <input type="text" id="setup-person2" placeholder="Desy">
        </div>
      </div>
      
      <div class="form-group">
        <label for="setup-couple-id">ID Coppia Unico:</label>
        <input type="text" id="setup-couple-id" placeholder="jakob-desy-2025">
        <small>Condividi questo ID con il tuo partner per connettervi allo stesso tracker</small>
      </div>
      
      <div class="form-group">
        <label for="setup-who">Chi sei tu?</label>
        <select id="setup-who">
          <option value="person1">Persona 1 (primo nome)</option>
          <option value="person2">Persona 2 (partner)</option>
        </select>
      </div>
      
      <button id="save-setup" class="btn btn-primary">Salva e Inizia il Tracking</button>
    </div>

    <!-- Connection Status -->
    <div id="connection-status" class="connection-status">
      <span class="status-dot"></span>
      <span class="status-text">Connessione...</span>
    </div>

    <!-- Map -->
    <div class="card map-card">
      <div id="map"></div>
    </div>

    <!-- Main Stats -->
    <div class="card stats-card">
      <div class="stats-grid">
        <div class="stat stat-distance">
          <div class="stat-label" id="distance-label">La nostra distanza: -- km</div>
          <div class="distance-visual">
            <span class="distance-initial" id="initial-1">J</span>
            <div class="distance-connector">
              <span class="distance-line"></span>
              <span class="distance-heart">ğŸ’•</span>
              <span class="distance-line"></span>
            </div>
            <span class="distance-initial" id="initial-2">D</span>
          </div>
          <div class="distance-message" id="distance-message"></div>
        </div>
        <div class="stat">
          <div class="stat-label">Giorni Insieme</div>
          <div class="stat-value" id="days-together">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Prossimo Incontro</div>
          <div class="stat-value" id="days-until-meet">Presto âœ¨</div>
        </div>
      </div>
    </div>

    <!-- Location Cards -->
    <div class="locations-grid">
      <!-- Person 1 -->
      <div class="card location-card">
        <div class="location-header">
          <span class="location-emoji">ğŸ“</span>
          <span class="location-name" id="person1-label">Jakob</span>
        </div>
        <div class="location-coords" id="person1-coords">In attesa della posizione...</div>
        <div class="location-city" id="person1-city"></div>
        <div class="location-updated" id="person1-updated">--</div>
      </div>
      
      <!-- Person 2 -->
      <div class="card location-card">
        <div class="location-header">
          <span class="location-emoji">ğŸ“</span>
          <span class="location-name" id="person2-label">Partner</span>
        </div>
        <div class="location-coords" id="person2-coords">In attesa della posizione...</div>
        <div class="location-city" id="person2-city"></div>
        <div class="location-updated" id="person2-updated">--</div>
      </div>
    </div>

    <!-- Controls -->
    <div class="card controls-card">
      <button id="update-location" class="btn btn-primary">
        ğŸ“ Aggiorna la Mia Posizione
      </button>
      <button id="toggle-tracking" class="btn btn-secondary">
        ğŸ”„ Avvia Tracciamento Auto
      </button>
      <button id="show-settings" class="btn btn-ghost">
        âš™ï¸ Impostazioni
      </button>
      <button id="sign-out-btn" class="btn btn-ghost">
        ğŸšª Esci
      </button>
    </div>

    <!-- Love Note -->
    <div class="card love-card">
      <p class="love-note">I chilometri ci separano.<br>Ma non cambiano quello che sento per te.</p>
      <p class="love-footer">P.S. Buon San Valentino, amore mio. Vorrei essere lÃ¬ con te oggi, ma finchÃ© non posso, ti mando un bacio lungo quanto la distanza tra noi. â¤ï¸</p>
    </div>

    <!-- Install Prompt -->
    <div id="install-prompt" class="install-prompt hidden">
      <p>ğŸ“± Installa questa app sul tuo telefono per un accesso rapido!</p>
      <button id="install-btn" class="btn btn-primary">Installa App</button>
      <button id="dismiss-install" class="btn btn-ghost">Forse Dopo</button>
    </div>
  </div> <!-- end main-app -->

  <!-- ============================================
       TULIP FIELD STYLES (DISABLED)
       To enable: Remove the comment markers
       ============================================ -->
  <!--
  <style>
    .field{
      position: absolute;
      inset: 0;
      overflow: hidden;
      pointer-events: none;
      z-index: 0;
    }
    .field .t{
      position:absolute;
      width: var(--s);
      opacity: var(--o);
      transform: translate(-50%, -50%) rotate(var(--r));
      filter: blur(var(--b));
    }
    /* Keep the field subtle on dark UI */
    .field .t svg{
      width:100%;
      height:auto;
    }

    /* Optional: slight breathing motion */
    .field .t{
      animation: floaty var(--d) ease-in-out infinite;
    }
    @keyframes floaty{
      0%,100%{ transform: translate(-50%,-50%) rotate(var(--r)) translateY(0); }
      50%{ transform: translate(-50%,-50%) rotate(var(--r)) translateY(-6px); }
    }
  </style>
  -->

  <!-- Leaflet for maps (free, no API key needed) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  
  <!-- ============================================
       TULIP FIELD SCRIPT (DISABLED)
       To enable: Remove the comment markers
       ============================================ -->
  <!--
  <script>
    const container = document.getElementById("tulip-field");

    // Small tulip SVG as a string (white, minimal)
    const tulipSVG = `
    <svg viewBox="0 0 120 160">
      <path d="M60 150 C60 120, 61 96, 60 76 C59 56, 56 44, 60 30"
        fill="none" stroke="rgba(180,255,210,.35)" stroke-width="4" stroke-linecap="round"/>
      <path d="M58 110 C40 104, 34 120, 40 134 C48 152, 60 150, 66 144 C58 132, 56 122, 58 110Z"
        fill="rgba(140,220,180,.10)" stroke="rgba(170,255,220,.12)" stroke-width="1.5"/>
      <path d="M62 104 C82 98, 88 112, 84 130 C80 150, 64 152, 54 146 C64 134, 66 120, 62 104Z"
        fill="rgba(140,220,180,.08)" stroke="rgba(170,255,220,.10)" stroke-width="1.5"/>
      <path d="M60 18
        C44 26, 38 44, 42 62
        C46 82, 54 92, 60 100
        C66 92, 74 82, 78 62
        C82 44, 76 26, 60 18Z"
        fill="rgba(255,255,255,.70)" stroke="rgba(255,255,255,.18)" stroke-width="1.5"/>
      <path d="M60 26
        C52 38, 50 54, 53 68
        C55 80, 58 90, 60 98
        C62 90, 65 80, 67 68
        C70 54, 68 38, 60 26Z"
        fill="rgba(255,255,255,.38)" stroke="rgba(255,255,255,.10)" stroke-width="1.2"/>
    </svg>`;

    const rand = (a,b)=> a + Math.random()*(b-a);

    function makeTulip(){
      const d = document.createElement("div");
      d.className = "t";
      d.style.left = rand(0,100) + "%";
      d.style.top  = rand(0,100) + "%";
      d.style.setProperty("--s", rand(18, 56) + "px");
      d.style.setProperty("--o", rand(0.05, 0.22).toFixed(2));
      d.style.setProperty("--r", rand(-18, 18).toFixed(1) + "deg");
      d.style.setProperty("--b", rand(0, 0.7).toFixed(2) + "px");
      d.style.setProperty("--d", rand(5, 11).toFixed(1) + "s");
      d.innerHTML = tulipSVG;
      return d;
    }

    // Adjust count based on screen area
    const count = Math.min(42, Math.max(18, Math.floor((innerWidth*innerHeight)/50000)));
    for(let i=0;i<count;i++) container.appendChild(makeTulip());
  </script>
  -->
  
  <script src="app.js"></script>
</body>
</html>
