<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0b0f17">
  <meta name="description" content="Real-time distance tracker for long-distance relationships">
  <title>Distance Doesn't Matter ğŸ«¶</title>
  
  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icons/icon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="icons/icon.svg">
  
  <!-- Styles -->
  <link rel="stylesheet" href="style.css">
  
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>
</head>
<body>
  
  <!-- ============================================
       TULIP FIELD ANIMATION (DISABLED)
       To enable: Remove the comments around this section
       and uncomment the CSS/JS code below
       ============================================ -->
  <!-- 
  <div id="tulip-field" class="field" aria-hidden="true"></div>
  -->

  <!-- Decorative Tulips -->
  <img src="icons/tulip-flower-tulip-e86aa6cc84acd5541c7c39395ff77aa9.png" 
       class="tulip-decoration tulip-left" 
       alt="Tulip decoration">
  
  <img src="icons/tulip-flower-tulip-e86aa6cc84acd5541c7c39395ff77aa9.png" 
       class="tulip-decoration tulip-right" 
       alt="Tulip decoration">

  <!-- OLD SVG CODE REMOVED -->
  <!--
  <div class="tulip-decoration-old tulip-left">
    <svg class="tulip-svg" viewBox="0 0 200 280" aria-label="Tulip">
      <defs>
        <!-- Gradient for stem -->
        <linearGradient id="stemGrad" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" style="stop-color:rgb(100,180,120);stop-opacity:0.9" />
          <stop offset="100%" style="stop-color:rgb(70,140,90);stop-opacity:0.8" />
        </linearGradient>
        <!-- Gradient for leaves -->
        <linearGradient id="leafGrad" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:rgb(120,200,140);stop-opacity:0.3" />
          <stop offset="50%" style="stop-color:rgb(90,170,110);stop-opacity:0.25" />
          <stop offset="100%" style="stop-color:rgb(70,140,90);stop-opacity:0.2" />
        </linearGradient>
        <!-- Gradient for petals -->
        <radialGradient id="petalGrad" cx="50%" cy="30%">
          <stop offset="0%" style="stop-color:rgb(255,255,255);stop-opacity:1" />
          <stop offset="70%" style="stop-color:rgb(250,248,252);stop-opacity:0.95" />
          <stop offset="100%" style="stop-color:rgb(240,235,245);stop-opacity:0.9" />
        </radialGradient>
      </defs>
      
      <g class="grow">
        <!-- Stem with gradient -->
        <path class="stem" 
          d="M100 265 C100 230, 102 200, 100 170 C98 140, 95 110, 100 85" 
          fill="none" stroke="url(#stemGrad)" stroke-width="5" stroke-linecap="round"/>
        
        <!-- Left leaf with realistic curve -->
        <path class="leaf"
          d="M98 195 C75 190, 60 200, 58 218 C56 235, 65 248, 80 252 C90 248, 95 235, 98 220 Z"
          fill="url(#leafGrad)" stroke="rgba(70,140,90,0.4)" stroke-width="1.5"/>
        <!-- Leaf vein -->
        <path d="M98 195 Q85 210, 80 235" 
          fill="none" stroke="rgba(100,180,120,0.3)" stroke-width="1" stroke-linecap="round"/>
        
        <!-- Right leaf with realistic curve -->
        <path class="leaf"
          d="M102 185 C125 180, 140 190, 142 208 C144 225, 135 238, 120 242 C110 238, 105 225, 102 210 Z"
          fill="url(#leafGrad)" stroke="rgba(70,140,90,0.4)" stroke-width="1.5"/>
        <!-- Leaf vein -->
        <path d="M102 185 Q115 200, 120 225" 
          fill="none" stroke="rgba(100,180,120,0.3)" stroke-width="1" stroke-linecap="round"/>
        
        <!-- Individual realistic petals -->
        <!-- Back left petal -->
        <path class="petal"
          d="M90 75 C75 68, 65 55, 62 40 C60 25, 68 12, 82 8 C92 10, 95 20, 98 35 C99 50, 96 65, 90 75 Z"
          fill="url(#petalGrad)" stroke="rgba(220,220,230,0.5)" stroke-width="1.5"/>
        
        <!-- Back right petal -->
        <path class="petal"
          d="M110 75 C125 68, 135 55, 138 40 C140 25, 132 12, 118 8 C108 10, 105 20, 102 35 C101 50, 104 65, 110 75 Z"
          fill="url(#petalGrad)" stroke="rgba(220,220,230,0.5)" stroke-width="1.5"/>
        
        <!-- Back center petal -->
        <path class="petal"
          d="M100 70 C100 55, 98 40, 95 25 C93 10, 95 2, 100 0 C105 2, 107 10, 105 25 C102 40, 100 55, 100 70 Z"
          fill="url(#petalGrad)" stroke="rgba(230,230,240,0.6)" stroke-width="1.5"/>
        
        <!-- Front left petal (brighter) -->
        <path class="petal-front"
          d="M85 80 C72 70, 68 52, 70 35 C72 20, 82 10, 92 12 C98 18, 100 30, 100 48 C100 62, 93 72, 85 80 Z"
          fill="rgba(255,255,255,0.95)" stroke="rgba(240,240,245,0.7)" stroke-width="1.5"/>
        <!-- Front left petal highlight -->
        <ellipse cx="88" cy="45" rx="8" ry="15" 
          fill="rgba(255,255,255,0.4)" opacity="0.6"/>
        
        <!-- Front right petal (brighter) -->
        <path class="petal-front"
          d="M115 80 C128 70, 132 52, 130 35 C128 20, 118 10, 108 12 C102 18, 100 30, 100 48 C100 62, 107 72, 115 80 Z"
          fill="rgba(255,255,255,0.95)" stroke="rgba(240,240,245,0.7)" stroke-width="1.5"/>
        <!-- Front right petal highlight -->
        <ellipse cx="112" cy="45" rx="8" ry="15" 
          fill="rgba(255,255,255,0.4)" opacity="0.6"/>
        
        <!-- Center detail (pistil area) -->
        <ellipse cx="100" cy="65" rx="6" ry="8" 
          fill="rgba(255,250,240,0.3)" stroke="none"/>
      </g>
    </svg>
  </div>
  
  <div class="tulip-decoration-old tulip-right">
    <svg class="tulip-svg" viewBox="0 0 200 280" aria-label="Tulip">
      <defs>
        <!-- Gradient for stem -->
        <linearGradient id="stemGrad2" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" style="stop-color:rgb(100,180,120);stop-opacity:0.9" />
          <stop offset="100%" style="stop-color:rgb(70,140,90);stop-opacity:0.8" />
        </linearGradient>
        <!-- Gradient for leaves -->
        <linearGradient id="leafGrad2" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:rgb(120,200,140);stop-opacity:0.3" />
          <stop offset="50%" style="stop-color:rgb(90,170,110);stop-opacity:0.25" />
          <stop offset="100%" style="stop-color:rgb(70,140,90);stop-opacity:0.2" />
        </linearGradient>
        <!-- Gradient for petals -->
        <radialGradient id="petalGrad2" cx="50%" cy="30%">
          <stop offset="0%" style="stop-color:rgb(255,255,255);stop-opacity:1" />
          <stop offset="70%" style="stop-color:rgb(250,248,252);stop-opacity:0.95" />
          <stop offset="100%" style="stop-color:rgb(240,235,245);stop-opacity:0.9" />
        </radialGradient>
      </defs>
      
      <g class="grow">
        <!-- Stem with gradient -->
        <path class="stem" 
          d="M100 265 C100 230, 98 200, 100 170 C102 140, 105 110, 100 85" 
          fill="none" stroke="url(#stemGrad2)" stroke-width="5" stroke-linecap="round"/>
        
        <!-- Left leaf with realistic curve -->
        <path class="leaf"
          d="M98 190 C75 185, 60 195, 58 213 C56 230, 65 243, 80 247 C90 243, 95 230, 98 215 Z"
          fill="url(#leafGrad2)" stroke="rgba(70,140,90,0.4)" stroke-width="1.5"/>
        <!-- Leaf vein -->
        <path d="M98 190 Q85 205, 80 230" 
          fill="none" stroke="rgba(100,180,120,0.3)" stroke-width="1" stroke-linecap="round"/>
        
        <!-- Right leaf with realistic curve -->
        <path class="leaf"
          d="M102 180 C125 175, 140 185, 142 203 C144 220, 135 233, 120 237 C110 233, 105 220, 102 205 Z"
          fill="url(#leafGrad2)" stroke="rgba(70,140,90,0.4)" stroke-width="1.5"/>
        <!-- Leaf vein -->
        <path d="M102 180 Q115 195, 120 220" 
          fill="none" stroke="rgba(100,180,120,0.3)" stroke-width="1" stroke-linecap="round"/>
        
        <!-- Individual realistic petals -->
        <!-- Back left petal -->
        <path class="petal"
          d="M90 75 C75 68, 65 55, 62 40 C60 25, 68 12, 82 8 C92 10, 95 20, 98 35 C99 50, 96 65, 90 75 Z"
          fill="url(#petalGrad2)" stroke="rgba(220,220,230,0.5)" stroke-width="1.5"/>
        
        <!-- Back right petal -->
        <path class="petal"
          d="M110 75 C125 68, 135 55, 138 40 C140 25, 132 12, 118 8 C108 10, 105 20, 102 35 C101 50, 104 65, 110 75 Z"
          fill="url(#petalGrad2)" stroke="rgba(220,220,230,0.5)" stroke-width="1.5"/>
        
        <!-- Back center petal -->
        <path class="petal"
          d="M100 70 C100 55, 98 40, 95 25 C93 10, 95 2, 100 0 C105 2, 107 10, 105 25 C102 40, 100 55, 100 70 Z"
          fill="url(#petalGrad2)" stroke="rgba(230,230,240,0.6)" stroke-width="1.5"/>
        
        <!-- Front left petal (brighter) -->
        <path class="petal-front"
          d="M85 80 C72 70, 68 52, 70 35 C72 20, 82 10, 92 12 C98 18, 100 30, 100 48 C100 62, 93 72, 85 80 Z"
          fill="rgba(255,255,255,0.95)" stroke="rgba(240,240,245,0.7)" stroke-width="1.5"/>
        <!-- Front left petal highlight -->
        <ellipse cx="88" cy="45" rx="8" ry="15" 
          fill="rgba(255,255,255,0.4)" opacity="0.6"/>
        
        <!-- Front right petal (brighter) -->
        <path class="petal-front"
          d="M115 80 C128 70, 132 52, 130 35 C128 20, 118 10, 108 12 C102 18, 100 30, 100 48 C100 62, 107 72, 115 80 Z"
          fill="rgba(255,255,255,0.95)" stroke="rgba(240,240,245,0.7)" stroke-width="1.5"/>
        <!-- Front right petal highlight -->
        <ellipse cx="112" cy="45" rx="8" ry="15" 
          fill="rgba(255,255,255,0.4)" opacity="0.6"/>
        
        <!-- Center detail (pistil area) -->
        <ellipse cx="100" cy="65" rx="6" ry="8" 
          fill="rgba(255,250,240,0.3)" stroke="none"/>
      </g>
    </svg>
  </div>
  -->

  <!-- Auth Screen -->
  <div id="auth-screen" class="auth-screen hidden">
    <div class="auth-container">
      <div class="auth-icon">ğŸ«¶</div>
      <h1 class="auth-title">Distance Doesn't Matter</h1>
      <p class="auth-subtitle">Sign in to access your tracker</p>
      
      <div id="auth-form" class="auth-form">
        <div class="form-group">
          <label for="auth-email">Email</label>
          <input type="email" id="auth-email" placeholder="your@email.com" autocomplete="email">
        </div>
        <div class="form-group">
          <label for="auth-password">Password</label>
          <input type="password" id="auth-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password">
        </div>
        <div id="auth-error" class="auth-error hidden"></div>
        <button id="auth-signin-btn" class="btn btn-primary btn-full">Sign In</button>
        <button id="auth-signup-btn" class="btn btn-secondary btn-full">Create Account</button>
      </div>
      
      <p class="auth-footer">Your data is protected with end-to-end security ğŸ”’</p>
    </div>
  </div>

  <!-- PIN Lock Screen -->
  <div id="pin-lock-screen" class="pin-lock-screen hidden">
    <div class="pin-container">
      <div class="pin-icon">ğŸ”’</div>
      <h2 id="pin-title">Enter PIN</h2>
      <p id="pin-subtitle" class="pin-subtitle">Enter your 4-digit PIN to unlock</p>
      <div class="pin-dots" id="pin-dots">
        <span class="pin-dot"></span>
        <span class="pin-dot"></span>
        <span class="pin-dot"></span>
        <span class="pin-dot"></span>
      </div>
      <div id="pin-error" class="pin-error hidden">Incorrect PIN. Try again.</div>
      <div class="pin-keypad">
        <button class="pin-key" data-key="1">1</button>
        <button class="pin-key" data-key="2">2</button>
        <button class="pin-key" data-key="3">3</button>
        <button class="pin-key" data-key="4">4</button>
        <button class="pin-key" data-key="5">5</button>
        <button class="pin-key" data-key="6">6</button>
        <button class="pin-key" data-key="7">7</button>
        <button class="pin-key" data-key="8">8</button>
        <button class="pin-key" data-key="9">9</button>
        <button class="pin-key pin-key-empty"></button>
        <button class="pin-key" data-key="0">0</button>
        <button class="pin-key pin-key-delete" data-key="delete">âŒ«</button>
      </div>
    </div>
  </div>

  <div class="container hidden" id="main-app">
    <!-- Header -->
    <header class="header">
      <h1 class="title">Distance Doesn't Matter <span class="heart">ğŸ«¶</span></h1>
      <p class="subtitle">Real-time tracker for <span id="person1-name">Jakob</span> & <span id="person2-name">â¤ï¸</span></p>
    </header>

    <!-- Setup Panel (shown first time) -->
    <div id="setup-panel" class="card setup-panel hidden">
      <h2>ğŸ”§ First Time Setup</h2>
      <p>Configure your Firebase project and names:</p>
      
      <div class="form-group">
        <label for="firebase-config">Firebase Config (paste JSON):</label>
        <textarea id="firebase-config" rows="6" placeholder='{
  "apiKey": "your-api-key",
  "authDomain": "your-project.firebaseapp.com",
  "databaseURL": "https://your-project-default-rtdb.firebaseio.com",
  "projectId": "your-project"
}'></textarea>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="setup-person1">Your Name:</label>
          <input type="text" id="setup-person1" placeholder="Jakob">
        </div>
        <div class="form-group">
          <label for="setup-person2">Partner's Name:</label>
          <input type="text" id="setup-person2" placeholder="â¤ï¸">
        </div>
      </div>
      
      <div class="form-group">
        <label for="setup-couple-id">Unique Couple ID:</label>
        <input type="text" id="setup-couple-id" placeholder="jakob-emma-2025">
        <small>Share this ID with your partner so you both connect to the same tracker</small>
      </div>
      
      <div class="form-group">
        <label for="setup-who">Who are you?</label>
        <select id="setup-who">
          <option value="person1">Person 1 (first name)</option>
          <option value="person2">Person 2 (partner)</option>
        </select>
      </div>
      
      <button id="save-setup" class="btn btn-primary">Save & Start Tracking</button>
    </div>

    <!-- Connection Status -->
    <div id="connection-status" class="connection-status">
      <span class="status-dot"></span>
      <span class="status-text">Connecting...</span>
    </div>

    <!-- Map -->
    <div class="card map-card">
      <div id="map"></div>
    </div>

    <!-- Main Stats -->
    <div class="card stats-card">
      <div class="stats-grid">
        <div class="stat stat-distance">
          <div class="stat-label" id="distance-label">Our distance: -- km</div>
          <div class="distance-visual">
            <span class="distance-initial" id="initial-1">J</span>
            <div class="distance-connector">
              <span class="distance-line"></span>
              <span class="distance-heart">ğŸ’•</span>
              <span class="distance-line"></span>
            </div>
            <span class="distance-initial" id="initial-2">D</span>
          </div>
          <div class="distance-message" id="distance-message"></div>
        </div>
        <div class="stat">
          <div class="stat-label">Days Together</div>
          <div class="stat-value" id="days-together">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Next Meet</div>
          <div class="stat-value" id="days-until-meet">Soon âœ¨</div>
        </div>
      </div>
    </div>

    <!-- Location Cards -->
    <div class="locations-grid">
      <!-- Person 1 -->
      <div class="card location-card">
        <div class="location-header">
          <span class="location-emoji">ğŸ“</span>
          <span class="location-name" id="person1-label">Jakob</span>
        </div>
        <div class="location-coords" id="person1-coords">Waiting for location...</div>
        <div class="location-city" id="person1-city"></div>
        <div class="location-updated" id="person1-updated">--</div>
      </div>
      
      <!-- Person 2 -->
      <div class="card location-card">
        <div class="location-header">
          <span class="location-emoji">ğŸ“</span>
          <span class="location-name" id="person2-label">Partner</span>
        </div>
        <div class="location-coords" id="person2-coords">Waiting for location...</div>
        <div class="location-city" id="person2-city"></div>
        <div class="location-updated" id="person2-updated">--</div>
      </div>
    </div>

    <!-- Controls -->
    <div class="card controls-card">
      <button id="update-location" class="btn btn-primary">
        ğŸ“ Update My Location
      </button>
      <button id="toggle-tracking" class="btn btn-secondary">
        ğŸ”„ Start Auto-Tracking
      </button>
      <button id="show-settings" class="btn btn-ghost">
        âš™ï¸ Settings
      </button>
      <button id="sign-out-btn" class="btn btn-ghost">
        ğŸšª Sign Out
      </button>
    </div>

    <!-- Love Note -->
    <div class="card love-card">
      <p class="love-note">Distance is just a number.<br>What matters is that I choose you â€” every day.</p>
      <p class="love-footer">P.S. If distance is a number, then my love is an invariant. â¤ï¸</p>
    </div>

    <!-- Install Prompt -->
    <div id="install-prompt" class="install-prompt hidden">
      <p>ğŸ“± Install this app on your phone for quick access!</p>
      <button id="install-btn" class="btn btn-primary">Install App</button>
      <button id="dismiss-install" class="btn btn-ghost">Maybe Later</button>
    </div>
  </div> <!-- end main-app -->

  <!-- ============================================
       TULIP FIELD STYLES (DISABLED)
       To enable: Remove the comment markers
       ============================================ -->
  <!--
  <style>
    .field{
      position: absolute;
      inset: 0;
      overflow: hidden;
      pointer-events: none;
      z-index: 0;
    }
    .field .t{
      position:absolute;
      width: var(--s);
      opacity: var(--o);
      transform: translate(-50%, -50%) rotate(var(--r));
      filter: blur(var(--b));
    }
    /* Keep the field subtle on dark UI */
    .field .t svg{
      width:100%;
      height:auto;
    }

    /* Optional: slight breathing motion */
    .field .t{
      animation: floaty var(--d) ease-in-out infinite;
    }
    @keyframes floaty{
      0%,100%{ transform: translate(-50%,-50%) rotate(var(--r)) translateY(0); }
      50%{ transform: translate(-50%,-50%) rotate(var(--r)) translateY(-6px); }
    }
  </style>
  -->

  <!-- Leaflet for maps (free, no API key needed) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  
  <!-- ============================================
       TULIP FIELD SCRIPT (DISABLED)
       To enable: Remove the comment markers
       ============================================ -->
  <!--
  <script>
    const container = document.getElementById("tulip-field");

    // Small tulip SVG as a string (white, minimal)
    const tulipSVG = `
    <svg viewBox="0 0 120 160">
      <path d="M60 150 C60 120, 61 96, 60 76 C59 56, 56 44, 60 30"
        fill="none" stroke="rgba(180,255,210,.35)" stroke-width="4" stroke-linecap="round"/>
      <path d="M58 110 C40 104, 34 120, 40 134 C48 152, 60 150, 66 144 C58 132, 56 122, 58 110Z"
        fill="rgba(140,220,180,.10)" stroke="rgba(170,255,220,.12)" stroke-width="1.5"/>
      <path d="M62 104 C82 98, 88 112, 84 130 C80 150, 64 152, 54 146 C64 134, 66 120, 62 104Z"
        fill="rgba(140,220,180,.08)" stroke="rgba(170,255,220,.10)" stroke-width="1.5"/>
      <path d="M60 18
        C44 26, 38 44, 42 62
        C46 82, 54 92, 60 100
        C66 92, 74 82, 78 62
        C82 44, 76 26, 60 18Z"
        fill="rgba(255,255,255,.70)" stroke="rgba(255,255,255,.18)" stroke-width="1.5"/>
      <path d="M60 26
        C52 38, 50 54, 53 68
        C55 80, 58 90, 60 98
        C62 90, 65 80, 67 68
        C70 54, 68 38, 60 26Z"
        fill="rgba(255,255,255,.38)" stroke="rgba(255,255,255,.10)" stroke-width="1.2"/>
    </svg>`;

    const rand = (a,b)=> a + Math.random()*(b-a);

    function makeTulip(){
      const d = document.createElement("div");
      d.className = "t";
      d.style.left = rand(0,100) + "%";
      d.style.top  = rand(0,100) + "%";
      d.style.setProperty("--s", rand(18, 56) + "px");
      d.style.setProperty("--o", rand(0.05, 0.22).toFixed(2));
      d.style.setProperty("--r", rand(-18, 18).toFixed(1) + "deg");
      d.style.setProperty("--b", rand(0, 0.7).toFixed(2) + "px");
      d.style.setProperty("--d", rand(5, 11).toFixed(1) + "s");
      d.innerHTML = tulipSVG;
      return d;
    }

    // Adjust count based on screen area
    const count = Math.min(42, Math.max(18, Math.floor((innerWidth*innerHeight)/50000)));
    for(let i=0;i<count;i++) container.appendChild(makeTulip());
  </script>
  -->
  
  <script src="app.js"></script>
</body>
</html>
